name: Commit message check

on:
  push:
    branches:
      - "feat/**"

jobs:
  check-commit-message:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ í•„ìš”

      - name: Validate commit messages
        run: |
          echo "ğŸ” Checking commit messages..."

          bad_commit=false

          # Conventional commit íŒ¨í„´
           pattern="^\[(ADD|UPDATE|FIX|DELETE|REFACTOR|TEST)\] .+"


          # pushëœ ì»¤ë°‹ë§Œ ê²€ì‚¬
          for commit in $(git rev-list ${{ github.event.before }}..${{ github.event.after }}); do
            msg=$(git log --format=%s -n 1 $commit)
            body=$(git log --format=%b -n 1 $commit)

            echo "â¡ Checking: $msg"

            # ì œëª© ê²€ì‚¬
            if ! echo "$msg" | grep -Eq "$pattern"; then
              echo "âŒ ì œëª© í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: $msg"
              bad_commit=true
            fi

            # Body ë¹„ì—ˆëŠ”ì§€ ê²€ì‚¬
            if [ -z "$body" ] || ! echo "$body" | grep -q "- "; then
              echo "âŒ Body(ë³¸ë¬¸) í•„ìˆ˜ì´ë©° - bullet í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤."
              bad_commit=true
            fi
          done

          if [ "$bad_commit" = true ]; then
            echo "âŒ Commit message does NOT follow B-style convention."
            exit 1
          else
            echo "âœ… All commit messages are valid."
          fi
